# 索引

索引就是用来提高查询效率从而引出的一个概念，要理解索引就要理解基础的索引数据结构

## 索引模型

1. 哈希表

- 说到索引很容易想到hash结构，这是一种key，value结构。可以用数组来存储，也可以用链表来存储，一般用数组来存储，经过哈希函数的运算，得到的值就是数组的索引，由于数组的长度有限装载因子的存在，当得到重复的值时，采用拉链法来解决。
- 优点：新增速度很快，适合等值查询，平均搜索速度log(N)
- 缺点：由于hash方法导致连续的值经过hash之后不是有序的，所以不适合区间查询，只适合noSql数据库

2. 有序数组

- 有序数组在等值查询和区间查询效率都比较高，用二分法查找效率也是log(n)
- 缺点： 有序数组在添加，删除索引时，需要移动后边的节点，消耗比较大

3. 2叉树

- 左子节点小于父节点，右子节点大于父节点
- 搜索，查询，删除效率都是log(N)

4. InnoDB数据模型

- InnoDB采用B+树，由于数据量比较大，数据分部在不同硬盘，采用2叉树的话，树比较高这样就需要在不同的磁盘去读取数据，磁盘间读取的效率比较低，所以采用B+树，这样可以减少海量数据在磁盘中的读取速度

5. 普通索引和主键索引

- 一般建立索引都会建立2个索引结构
    1. 主键索引
      存储整行数据
    2. 普通索引
      存储的是主键值
- 一般在建立索引的话建议以主键的方式建立索引，因为以其他字段建立索引首先会在普通索引里先查询到主键ID，然后在主键索引中搜索整行数据，这种行为称为回表

6. 索引的维护

- 由于使用B+树就会涉及到树的分裂及树的合并，这在B+树中是比较消耗性能的。所以我们一般采用的是自增主键来维护树的状态
- 由于主键占用的字节数比较少，所以一般也采用主键来建立索引

----

## 优化索引的方式

1. 覆盖索引

当我们想要执行这样一条语句时`select * from T where k between 3 and 5`首先我们会在普通索引树上找到相应的主键，然后在主键索引上搜索要查找的数据，
这样会发生回表的现象降低了效率，如果我们改成`select ID from T where k between 3 and 5`就会避免回表的情况
- 最左前缀原则，当利用索引进行查询时例如我有一个（name，age）的索引，查询语句`where name like ‘张 %’"`,就会利用这个索引。
- 第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的
- 然后就是空间的问题，比如有查询name和age的情况，又有各自的查询，这时候需要两个索引（name，age）和age

2. 索引下推

在mysql5.6以后例如我们执行`select * from tuser where name like '张 %' and age=10 and ismale=1;`会使用索引下推
在之前我们通过索引查到满足name条件的id，不去看age再去回表查处一行数据比较其他条件，现在通过索引下推，通过（name，age）两个字段的比较减少回表
